## Дано

Your Architectural Kata is...

Mock Internet UN

Organization running "Mock UN" events wants to take its events online, permitting students to participate online

Requirements: student-diplomats must be able to video-chat with one another; student-diplomats must be able to "give speeches" to the 
"assembly" (video-chat to the entire group); (mocked) world events (created by moderators) distributed via (mock) "news sites"; 
moderators must be able to monitor any video chat for appropriateness

Users: 500 or so "diplomats" per "mock UN" gathering; dozens of moderators per "mock UN"; many "mock UN"s simultaneously; no new 
hardware requirements on students

## 1. Выбор баз данных по сервисам

Сервис| База данных|    Обоснование выбора| Сценарии использования
--|--|--|--
Сервис авторизации|   PostgreSQL 15|  Требуются ACID-транзакции для регистрации, строгая схема данных. Совместим с ГОСТ-шифрованием.| Проверка учетных данных. Управление ролями. SSO-интеграция с университетами
Сервис мероприятий|  PostgreSQL 15|  Сложные запросы с JOIN между мероприятиями, участниками и расписаниями. Транзакционная целостность.| Создание мероприятий. Регистрация участников. Управление расписанием
Сервис видео|  Redis 7 (кэш) + Yandex Object Storage|  Redis: низкая задержка для сессий WebRTC. Object Storage: хранение больших бинарных объектов (записи трансляций).|  Кэш TURN-серверов. Метаданные сессий. Хранение записей трансляций
Сервис модерации| PostgreSQL 15|  Аудит-логи требуют строгой консистентности. Сложные запросы для аналитики.| Логирование действий модераторов. История предупреждений
Сервис новостей|   MongoDB 6|  Гибкая схема для разноформатных новостей. Высокая скорость записи событий.| Создание новостных событий. Тексты/медиа-вложения. Распространение новостей
Сервис уведомлений|   PostgreSQL 15|  Простые структурированные данные (шаблоны сообщений). Транзакции при отметке доставки.|  Шаблоны уведомлений. Логи отправки. Управление подписками
Сервис модерации| ClickHouse 23|  Оптимизирован для high-write нагрузок и временных рядов. Быстрые агрегации по логам.| Метрики производительности. Анализ логов. Генерация отчетов

## 2. Репликации

Сервис| База данных|    Стратегия репликации|   Обоснование
--|--|--|--
Сервис авторизации|   PostgreSQL| Синхронная (1 мастер → 2 реплики)|  Гарантия zero data loss. Реплики для балансировки чтения
Сервис мероприятий|  PostgreSQL| Асинхронная (1 мастер → 3 реплики)| Высокая доступность. Реплики в разных AZ
Сервис видео|  Redis|  Redis Cluster: автоматическая репликация шардов (1 мастер → 1 реплика)| Отказоустойчивость сессий
Сервис модерации| PostgreSQL| Синхронная WAL-репликация → S3 для аудита|  Соответствие ФЗ-152 (хранение логов 6 месяцев)
Сервис новостей|   MongoDB|    Replica Set (1 primary, 2 secondary, 1 arbiter)|    Автоматический failover. Чтение с nearest secondary
Сервис уведомлений|   PostgreSQL| Логическая репликация (только для шаблонов сообщений)|  Изоляция критичных данных
Сервис модерации| ClickHouse| Distributed + ReplicatedMergeTree (данные на 3 нодах)|  Отказоустойчивость при high-write нагрузках

## 3. Шардинг

Сервис| База данных|    Ключ шардинга|  Стратегия|  Обоснование
--|--|--|--|--
Сервис авторизации|   PostgreSQL| university_id|  Hash-шардинг|   Распределение нагрузки по университетам
Сервис мероприятий|  PostgreSQL| event_id|   Range-шардинг|  Равномерное распределение мероприятий по шардам
Сервис видео|  Redis|  Ключ сессии (CRC16)|    Авто-шардинг в кластере|    Встроенная поддержка в Redis Cluster
Сервис модерации| PostgreSQL| moderator_id|   Hash-шардинг|   Распределение нагрузки по модераторам
Сервис новостей|   MongoDB|    event_id|   Hashed sharding|    Равномерное распределение новостей событий
Сервис модерации| ClickHouse| toYYYYMM(timestamp)|    Партиционирование по месяцам|   Оптимизация запросов по временным диапазонам
