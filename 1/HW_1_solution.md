## Дано

Your Architectural Kata is...

Mock Internet UN

Organization running "Mock UN" events wants to take its events online, permitting students to participate online


Requirements: student-diplomats must be able to video-chat with one another; student-diplomats must be able to "give speeches" to the 

"assembly" (video-chat to the entire group); (mocked) world events (created by moderators) distributed via (mock) "news sites"; 

moderators must be able to monitor any video chat for appropriateness


Users: 500 or so "diplomats" per "mock UN" gathering; dozens of moderators per "mock UN"; many "mock UN"s simultaneously; no new 
hardware requirements on students

## Решение

### 1. Отсев

Определены ключевые требования, исключены несущественные:

1. Ключевые :
* Видеочаты между студентами-дипломатами.
* Возможность выступлений перед всей аудиторией ("общий зал").
* Мониторинг видеочатов модераторами.
* Распределение имитированных мировых событий через "новостные сайты".
2. Исключены :
* Требования к установке специального ПО на устройства студентов (проект должен быть полностью браузерным).
* Поддержка VR/AR (не указано в требованиях).

### 2. Scope Refinement

Уточнены детали реализации:

1. Видеочаты
* Поддержка 1:1 и групповых чатов (до 10 участников в группе).
* Использование WebRTC для низкой задержки без установки клиентов.
2. Выступления
* Режим "общего зала" с трансляцией видео и аудио всем участникам.
* Очередь выступающих, управляемая модераторами.
3. Мониторинг модераторов
* Возможность "подключения" к любому активному видеочату в режиме наблюдения.
* Функция отправки предупреждений участникам.
4. Новостные сайты
* Генерация событий модераторами (например, "землетрясение в регионе X").
* Интеграция с системой мероприятий для автоматического обновления новостей.

### 3. Функциональные требования

1. Для студентов-дипломатов
* Регистрация/вход через почту или SSO (университетские аккаунты).
* Создание и присоединение к видеочатам.
* Выступление в общем зале с возможностью голосования за темы.
2. Для модераторов
* Создание мероприятий (название, дата, темы).
* Добавление/редактирование новостных событий.
* Мониторинг видеочатов и отправка предупреждений.
3. Для системы
* Масштабирование под 500 участников на мероприятие и одновременную работу сотен мероприятий.
* Логирование действий модераторов и пользователей.

### 4. Нефункциональные требования

1. Производительность
* Задержка видеочатов ≤ 200 мс (для WebRTC).
* Время загрузки главной страницы ≤ 2 секунды.
2. Безопасность
* Шифрование данных (HTTPS, SRTP для видеочатов).
* Соответствие российскому законодательству (ФЗ-152).
3. Масштабируемость
* Облачные решения (например, Яндекс.Облако) для динамического масштабирования серверов.
4. Совместимость
* Поддержка Chrome, Firefox, Safari (последние версии).
* Адаптивный интерфейс для мобильных устройств.

### 5. Ограничения

1. Технические
* Нельзя требовать от студентов установки дополнительного ПО.
* Ограничения на использование WebRTC в корпоративных сетях (возможно, реализовать fallback на медиасерверы).
2. Юридические
* Хранение персональных данных пользователей в РФ. Обязательна регистрация оператора ПДн в Роскомнадзоре.
* Если платформа используется в госорганах или образовательных учреждениях, требуется сертификат соответствия требованиям цифровой экосистемы РФ.
* Запрет на использование зарубежных CDN (например, Cloudflare) без локализации данных в РФ.
* Запрет на хостинг в иностранных облаках (AWS, Google Cloud).
3. Бюджетные
* Оптимизация затрат на облачные ресурсы (например, использование spot-инстансов для нетребовательных задач).
4. Импортозамещение
* Обязательное использование российских ОС (например, ALT Linux , Ред ОС ) на серверах.
* Для криптографии — алгоритмы ГОСТ 28147-89 , ГОСТ Р 34.10-2012 (вместо RSA/AES).
* Использование КриптоПро для сертификатов SSL/TLS.

### 6. Расчет нагрузки:

#### 6.1 Трафик

1. Видеочаты
* Каждый участник отправляет поток 1–2 Мбит/с (видео 720p).
* Для 500 участников: 500 × 2 Мбит/с = 1 Гбит/с на мероприятие.
* Использование SFU (Selective Forwarding Unit) для снижения нагрузки на клиентов.
2. Общий зал
* Трансляция одного потока всем участникам → 500 × 1 Мбит/с = 500 Мбит/с.
* Использование CDN (например, Cloudflare) для стриминга.

#### 6.2 БД

1. Сценарии использования
* Чтение: запросы к новостям, спискам мероприятий.
* Запись: логирование действий, обновление состояния чатов.
2. Рекомендуемые технологии
* PostgreSQL для структурированных данных (пользователи, мероприятия).
* Redis для кэширования новостей и временных данных чатов.
3. Нагрузка
* Пиковая нагрузка: 1000 операций чтения/секунду (новости), 500 операций записи/секунду (логи).
4. Примерный расчет емкости

* Пользователи. 500 участников × 10 мероприятий в год = 5000 пользователей. 
Каждый пользователь: ~1 КБ данных (логин, пароль, роль, метаданные).
Итого: ~5 МБ.
* Мероприятия. 100 мероприятий в месяц × 12 месяцев = 1200 мероприятий в год.
Каждое мероприятие: ~10 КБ (тема, дата, список участников).
Итого: ~12 МБ.
* Логи действий. Среднее количество записей: 1000 событий/мероприятие × 1200 мероприятий = 1.2 млн записей.
Каждая запись: ~200 Байт (дата, пользователь, действие).
Итого: ~240 МБ.
* Новости. 50 событий/мероприятие × 1200 мероприятий = 60 тыс. записей.
Каждое событие: ~1 КБ (текст, метаданные).
Итого: ~60 МБ.
* Итого для всей БД: ~320 МБ на год.